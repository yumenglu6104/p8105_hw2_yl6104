p1085_hw2_yl6104
================
Yumeng Lu
2025-09-25

## Problem 1

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.4     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(lubridate)
```

``` r
pols = read_csv("data/fivethirtyeight_datasets/pols-month.csv") %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(across(c("year", "month", "day"), as.integer),
         # turn month number into month name
         month = month.name[month],
         # create president variable
         president = case_when(
           prez_gop == 1 ~ "gop",
           prez_dem == 1 ~ "dem"
         )) %>% 
  select(-prez_dem, -prez_gop, -day)
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
head(pols)
```

    ## # A tibble: 6 × 9
    ##    year month    gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##   <int> <chr>      <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ## 1  1947 January       23      51     253      23      45     198 dem      
    ## 2  1947 February      23      51     253      23      45     198 dem      
    ## 3  1947 March         23      51     253      23      45     198 dem      
    ## 4  1947 April         23      51     253      23      45     198 dem      
    ## 5  1947 May           23      51     253      23      45     198 dem      
    ## 6  1947 June          23      51     253      23      45     198 dem

``` r
snp = read_csv("data/fivethirtyeight_datasets/snp.csv") %>% 
  mutate(date = mdy(date)) %>% 
  separate(date, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(
    across(c("year", "month", "day"), as.integer),
    year = if_else(year > 2049, year - 100L, year)) %>% 
  arrange(year, month) %>% 
  mutate(month = month.name[month]) %>% 
  relocate(year, month, everything()) %>% 
  select(-day) 
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
head(snp)
```

    ## # A tibble: 6 × 3
    ##    year month    close
    ##   <int> <chr>    <dbl>
    ## 1  1950 January   17.0
    ## 2  1950 February  17.2
    ## 3  1950 March     17.3
    ## 4  1950 April     18.0
    ## 5  1950 May       18.8
    ## 6  1950 June      17.7

``` r
unemployment = read_csv("data/fivethirtyeight_datasets/unemployment.csv") %>% 
  pivot_longer(cols = "Jan":"Dec", names_to = "month", values_to = "unemployment_rate") %>% 
  mutate(month = month.name[match(month, month.abb)]) %>% 
  rename("year" = "Year")
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
head(unemployment)
```

    ## # A tibble: 6 × 3
    ##    year month    unemployment_rate
    ##   <dbl> <chr>                <dbl>
    ## 1  1948 January                3.4
    ## 2  1948 February               3.8
    ## 3  1948 March                  4  
    ## 4  1948 April                  3.9
    ## 5  1948 May                    3.5
    ## 6  1948 June                   3.6

``` r
final_data = pols %>% 
  left_join(snp, by = c("year", "month")) %>% 
  left_join(unemployment, by = c("year", "month"))
```

The **`pols-month`** dataset has 822 rows and 9 columns, covering the
years from 1947 to 2015. It contains monthly information on U.S.
politics, including the party of the sitting president, and counts of
governors, senators, and representatives by party.

The **`snp`** dataset dataset has 787 rows and 3 columns, covering the
years from 1950 to 2015. It provides monthly closing values of the S&P
500 index.

The **`unemployment`** dataset has 816 rows and 3 columns, covering the
years from 1948 to 2015. It records U.S. unemployment rates by month and
year.

After cleaning and merging, the resulting dataset has **822
observations** and **11 variables**, spanning the years **1947 to
2015**. Key variables include the political party of the president
(`president`), counts of political officials (e.g., `sen_gop`,
`sen_dem`, `rep_gop`, `rep_dem`), the stock market closing value
(`close`), and the monthly unemployment rate (`unemployment_rate`).

## Problem 2

``` r
mr = readxl::read_excel("data/202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", skip = 1) %>% 
  select(-starts_with("...")) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sports_balls = as.integer(round(sports_balls, 0)),
         trash_wheel = "Mr",
         year = as.numeric(year))

professor = readxl::read_excel("data/202509 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sports_balls = NA_integer_,
         trash_wheel = "Professor")
  

gwynnda = readxl::read_excel("data/202509 Trash Wheel Collection Data.xlsx", sheet = "Gwynns Falls Trash Wheel", skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(sport_balls = NA_integer_,
         trash_wheel = "Gwynnda") 

trash_data = bind_rows(mr, professor, gwynnda) %>% 
  relocate(sport_balls, .before = trash_wheel)
head(trash_data)
```

    ## # A tibble: 6 × 16
    ##   dumpster month  year date                weight_tons volume_cubic_yards
    ##      <dbl> <chr> <dbl> <dttm>                    <dbl>              <dbl>
    ## 1        1 May    2014 2014-05-16 00:00:00        4.31                 18
    ## 2        2 May    2014 2014-05-16 00:00:00        2.74                 13
    ## 3        3 May    2014 2014-05-16 00:00:00        3.45                 15
    ## 4        4 May    2014 2014-05-17 00:00:00        3.1                  15
    ## 5        5 May    2014 2014-05-17 00:00:00        4.06                 18
    ## 6        6 May    2014 2014-05-20 00:00:00        2.71                 13
    ## # ℹ 10 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, sports_balls <int>, homes_powered <dbl>, sport_balls <int>,
    ## #   trash_wheel <chr>

The combined **Trash Wheel** dataset contains 1188 observations and 16
variables, compiled from Mr. Trash Wheel, Professor Trash Wheel, and
Gwynnda. Key variables include `dumpster` (the dumpster identifier),
`date` (the collection date), `weight_tons` (the amount of trash
collected), and `cigarette_butts` (the count of cigarette butts
collected), ect. The dataset also includes a `trash_wheel` variable
identifying which trash wheel collected the data. Across the available
data, **Professor Trash Wheel** collected a total of 282.26 tons of
trash. In **June 2022**, **Gwynnda** collected 18120 cigarette butts.

## Problem 3

``` r
zip_zori = read_csv("data/zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", show_col_types = FALSE, na = c(".", "NA", "")) %>%
  janitor::clean_names() %>% 
  rename("zip_code" = "region_name")

zip_codes = read_csv("data/zillow_data/Zip Codes.csv", show_col_types = FALSE, na = c(".", "NA", "")) %>%
  janitor::clean_names() %>% 
  filter(!(county == "New York" & zip_code %in% c(10463, 11202)))

missing_zips = anti_join(zip_codes, zip_zori, by = "zip_code")
missing_zips
```

    ## # A tibble: 171 × 7
    ##    county state_fips county_code county_fips zip_code file_date neighborhood    
    ##    <chr>       <dbl> <chr>             <dbl>    <dbl> <chr>     <chr>           
    ##  1 Bronx          36 005               36005    10464 7/25/07   Southeast Bronx 
    ##  2 Bronx          36 005               36005    10474 7/25/07   Hunts Point and…
    ##  3 Bronx          36 005               36005    10475 7/25/07   Northeast Bronx 
    ##  4 Bronx          36 005               36005    10499 7/25/07   <NA>            
    ##  5 Bronx          36 005               36005    10550 7/25/07   <NA>            
    ##  6 Bronx          36 005               36005    10704 7/25/07   <NA>            
    ##  7 Bronx          36 005               36005    10705 7/25/07   <NA>            
    ##  8 Bronx          36 005               36005    10803 7/25/07   <NA>            
    ##  9 Kings          36 047               36047    11202 7/25/07   <NA>            
    ## 10 Kings          36 047               36047    11224 7/25/07   Southern Brookl…
    ## # ℹ 161 more rows

``` r
zip_codes_clean = zip_codes %>%
  filter(!zip_code %in% missing_zips$zip_code)

zip_join = left_join(zip_zori, zip_codes_clean, by = "zip_code") %>% 
  pivot_longer(cols = "x2015_01_31":"x2024_08_31", names_to = "date", values_to = "zori_price") %>% 
  mutate(date = lubridate::ymd(str_remove(date, "^x"))) %>% 
  drop_na(zori_price) %>% 
  select(zip_code, county, city, date, zori_price, everything(), -state)
```

After cleaning and merging the ZIP code metadata with Zillow rental
price data, we obtained a single tidy dataset.

The dataset contains 10566 total observations (ZIP × month combinations
with non-missing rental prices).

It includes 149 unique ZIP codes across New York City.

Among these, there are 42 neighborhoods with non-missing names.

The final dataset is organized so that each row corresponds to a ZIP
code in a given month, and includes rental prices (zori_price),
geographic identifiers (county, city, neighborhood), and time (date).
This long-format structure makes the data ready for analysis and
visualization.

**Missing ZIP codes**

There are 171 ZIP codes that appear in the official ZIP code dataset but
not in the Zillow dataset. Some examples are:

``` r
head(missing_zips, 10)
```

    ## # A tibble: 10 × 7
    ##    county state_fips county_code county_fips zip_code file_date neighborhood    
    ##    <chr>       <dbl> <chr>             <dbl>    <dbl> <chr>     <chr>           
    ##  1 Bronx          36 005               36005    10464 7/25/07   Southeast Bronx 
    ##  2 Bronx          36 005               36005    10474 7/25/07   Hunts Point and…
    ##  3 Bronx          36 005               36005    10475 7/25/07   Northeast Bronx 
    ##  4 Bronx          36 005               36005    10499 7/25/07   <NA>            
    ##  5 Bronx          36 005               36005    10550 7/25/07   <NA>            
    ##  6 Bronx          36 005               36005    10704 7/25/07   <NA>            
    ##  7 Bronx          36 005               36005    10705 7/25/07   <NA>            
    ##  8 Bronx          36 005               36005    10803 7/25/07   <NA>            
    ##  9 Kings          36 047               36047    11202 7/25/07   <NA>            
    ## 10 Kings          36 047               36047    11224 7/25/07   Southern Brookl…

These ZIP codes may be excluded because they correspond to P.O. boxes,
newly created or retired ZIPs, or areas where Zillow does not track
enough rental data to compute reliable estimates.

``` r
price_change = zip_join %>%
  filter(date %in% c("2020-01-31", "2021-01-31")) %>%
  select(zip_code, county, neighborhood, date, zori_price) %>%
  pivot_wider(
    names_from = date, 
    values_from = zori_price,
  ) %>%
  mutate(price_drop = `2021-01-31` - `2020-01-31`) %>%
  drop_na(neighborhood) %>% 
  arrange(price_drop)

print(price_change %>% slice(1:10))
```

    ## # A tibble: 10 × 6
    ##    zip_code county   neighborhood           `2020-01-31` `2021-01-31` price_drop
    ##       <dbl> <chr>    <chr>                         <dbl>        <dbl>      <dbl>
    ##  1    10007 New York Lower Manhattan               6334.        5422.      -913.
    ##  2    10009 New York Lower East Side               3406.        2692.      -714.
    ##  3    10016 New York Gramercy Park and Mur…        3731.        3019.      -712.
    ##  4    10001 New York Chelsea and Clinton           4108.        3398.      -710.
    ##  5    10002 New York Lower East Side               3645.        2935.      -710.
    ##  6    10004 New York Lower Manhattan               3150.        2444.      -706.
    ##  7    10038 New York Lower Manhattan               3573.        2876.      -698.
    ##  8    10012 New York Greenwich Village and…        3629.        2942.      -686.
    ##  9    10010 New York Gramercy Park and Mur…        3697.        3012.      -685.
    ## 10    10003 New York Lower East Side               3570.        2897.      -673.

The largest rental price drops during the COVID-19 pandemic were
concentrated in Manhattan (New York County), particularly in high-rent
neighborhoods such as Midtown, the Financial District, and the Upper
East and West Sides. These areas were heavily affected by office
closures, the departure of residents, and a decline in international
students.

In contrast, outer boroughs such as Queens, Brooklyn, and the Bronx
experienced smaller declines, with some neighborhoods showing little to
no change. This pattern highlights that the pandemic’s economic shock
was most severe in dense, high-rent neighborhoods dependent on office
workers and transient populations.
